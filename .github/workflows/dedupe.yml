name: Remove Duplicate Flashcards

on:
  workflow_dispatch:

jobs:
  deduplicate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: Run deduplication script
      run: |
        python - <<'EOF'
        import csv

        # Input and output file paths
        input_file = 'kimshim.txt'
        output_file = 'kimshim_deduplicated.txt'

        # Track seen fronts and store unique rows
        seen_fronts = set()
        unique_rows = []

        # Read the CSV file
        with open(input_file, 'r', encoding='utf-8') as f:
            reader = csv.reader(f)
            
            # Read header
            header = next(reader)
            unique_rows.append(header)
            
            # Process each row
            for row in reader:
                if len(row) >= 2:
                    front = row[0]
                    
                    # Only keep first occurrence of each front
                    if front not in seen_fronts:
                        seen_fronts.add(front)
                        unique_rows.append(row)

        # Write to output file with preserved CSV format
        with open(output_file, 'w', encoding='utf-8', newline='') as f:
            writer = csv.writer(f)
            writer.writerows(unique_rows)

        print(f"Original rows: {len(unique_rows) - 1 + len(seen_fronts)}")
        print(f"Unique rows: {len(unique_rows) - 1}")
        print(f"Duplicates removed: {len(seen_fronts) - (len(unique_rows) - 1)}")
        print(f"Output saved to: {output_file}")
        EOF
        
    - name: Commit deduplicated file
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git add kimshim_deduplicated.txt
        git commit -m "Add deduplicated flashcards" || echo "No changes to commit"
        git push
