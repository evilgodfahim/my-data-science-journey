name: Deduplicate Flashcards
on:
  workflow_dispatch:
jobs:
  deduplicate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: Deduplicate
      run: |
        python - <<'EOF'
        import csv
        import os
        # Input and output file
        input_file = 'oneworde.txt'
        output_file = 'oneworde_temp.txt'
        # Track seen fronts and store unique rows
        seen_fronts = set()
        unique_rows = []
        # Read the input file
        with open(input_file, 'r', encoding='utf-8') as f:
            reader = csv.reader(f)
            
            # Process each row (no header)
            for row in reader:
                if len(row) >= 2:
                    front = row[0]
                    
                    # Only keep first occurrence of each front
                    if front not in seen_fronts:
                        seen_fronts.add(front)
                        unique_rows.append(row)
        
        print(f"Total rows processed: {len(seen_fronts)}")
        print(f"Unique rows kept: {len(unique_rows)}")
        print(f"Duplicates removed: {len(seen_fronts) - len(unique_rows)}")
        # Write to output file with preserved CSV format
        with open(output_file, 'w', encoding='utf-8', newline='') as f:
            writer = csv.writer(f)
            writer.writerows(unique_rows)
        print(f"Output saved to: {output_file}")
        
        # Replace original file with deduplicated version
        os.replace(output_file, input_file)
        print(f"Replaced {input_file} with deduplicated version")
        EOF
        
    - name: Commit merged file
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git add oneworde.txt
        git commit -m "Deduplicate oneworde.txt" || echo "No changes to commit"
        git push
